# Production overrides for docker-compose.yml
# Usage: docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

services:
  radicale:
    # Production resource allocation
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 1G
        reservations:
          cpus: '1'
          memory: 512M

    # More aggressive health check for production
    healthcheck:
      interval: 20s
      timeout: 5s
      retries: 5
      start_period: 30s

    # Logging with rotation
    logging:
      driver: "json-file"
      options:
        max-size: "50m"
        max-file: "5"
        labels: "service=radicale"

  web:
    # Production resource allocation
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 1G
        reservations:
          cpus: '1'
          memory: 512M

    # More aggressive health check for production
    healthcheck:
      interval: 20s
      timeout: 5s
      retries: 5
      start_period: 45s

    # Logging with rotation
    logging:
      driver: "json-file"
      options:
        max-size: "50m"
        max-file: "5"
        labels: "service=web"

volumes:
  radicale_collections:
    driver: local
    driver_opts:
      type: none
      o: bind
      # IMPORTANT: Change this path to your actual persistent storage location
      device: /mnt/radicale/collections

  radicale_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      # IMPORTANT: Change this path to your actual persistent storage location
      device: /mnt/radicale/data

  web_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      # IMPORTANT: Change this path to your actual persistent storage location
      device: /mnt/web/data
